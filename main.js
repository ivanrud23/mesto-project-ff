(()=>{"use strict";const e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-34",headers:{authorization:"3e6f5e59-f320-4d8a-83b4-d88e200489b5","Content-Type":"application/json"}},t=t=>{fetch(`${e.baseUrl}/cards/${t}`,{method:"DELETE",headers:e.headers}).then(n)},r=t=>fetch(`${e.baseUrl}/cards/likes/${t}`,{method:"PUT",headers:e.headers}).then(n),o=t=>fetch(`${e.baseUrl}/cards/likes/${t}`,{method:"DELETE",headers:e.headers}).then(n),n=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),a=e=>{console.log(e)};function c(e,t,r,o,n){const a=s(),c=a.querySelector(".card__image"),l=a.querySelector(".card__like-button"),u=a.querySelector(".card__like-count"),p=a.querySelector(".card__delete-button");return c.src=o.link,c.alt=o.name,a.querySelector(".card__title").textContent=o.name,u.textContent=o.likes.length,c.addEventListener("click",e),l.addEventListener("click",(e=>{t(e,o,n,u)})),o.owner._id===n?p.addEventListener("click",(e=>{r(o._id),i(e)})):p.remove(),d(o,n)&&l.classList.add("card__like-button_is-active"),a}const s=()=>document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);function l(e,t,r,o,n,a){const s=c(t,r,o,n,a);e.prepend(s)}function u(e,t,n,c){(d(t,n)?o:r)(t._id).then((r=>{e.target.classList.toggle("card__like-button_is-active"),t.likes=r.likes,c.textContent=r.likes.length})).catch(a)}function i(e){e.target.closest(".places__item").remove()}const d=(e,t)=>e.likes.some((e=>e._id===t));function p(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",m)}function _(){document.querySelector(".popup_is-opened").classList.remove("popup_is-opened"),document.removeEventListener("keydown",m)}function m(e){"Escape"===e.key&&_()}const y=e=>{e.querySelector(".popup__close").addEventListener("click",_),e.addEventListener("click",h)};function h(e){e.target.classList.contains("popup_is-opened")&&!e.target.classList.contains("popup__content")&&_()}const f=(e,t,r)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove(r.errorClass),o.classList.remove(r.errorClassTextActive),o.textContent=""},v=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(r.buttonClass)):(t.disabled=!1,t.classList.remove(r.buttonClass))},S=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);v(r,o,t),r.forEach((r=>{f(e,r,t),r.classList.remove(t.errorClass),r.value=""}))},b=document.querySelector(".places__list"),q=document.querySelector(".profile__image"),C=document.querySelector(".profile__avatar-botton"),L=document.querySelector(".popup_type_avatar"),g=L.querySelector(".popup__form"),k=L.querySelector(".popup__input_type_avatar"),x=document.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_new-card"),$=document.querySelector(".popup__input_type_card-name"),T=document.querySelector(".popup__input_type_url"),A=document.forms["new-place"],U=document.querySelector(".profile__edit-button"),w=document.querySelector(".popup_type_edit"),P=w.querySelector(".popup__form"),D=w.querySelector(".popup__input_type_name"),N=w.querySelector(".popup__input_type_description"),O=document.querySelector(".popup_type_image"),j=O.querySelector(".popup__image"),B=document.querySelector(".profile__title"),J=document.querySelector(".profile__description"),M={errorClass:"popup__input-error",errorClassText:"popup__input-error-text",errorSelectText:".popup__input-error-text",errorClassTextActive:"popup__input-error-text-active",inputSelector:".popup__input",submitButtonSelector:".popup__button",formSelector:".popup__form",buttonClass:"popup__button-inactive"};let H;function I(e){p(O),j.src=e.target.src,O.querySelector(".popup__caption").textContent=e.target.alt,j.alt=e.target.alt}Promise.all([fetch(`${e.baseUrl}/users/me`,{headers:e.headers}).then(n),fetch(`${e.baseUrl}/cards`,{headers:e.headers}).then(n)]).then((([e,r])=>{B.textContent=e.name,J.textContent=e.about,H=e._id,q.style.backgroundImage=`url(${e.avatar})`,r.forEach((e=>{l(b,I,u,t,e,H)}))})).catch(a),y(L),g.addEventListener("submit",(function(t){const r=t.target.querySelector(".button");var o;r.textContent="Сохранение...",t.preventDefault(),(o=k.value,fetch(`${e.baseUrl}/users/me/avatar`,{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(n)).then((e=>{q.style.backgroundImage=`url(${e.avatar})`})).catch(a).finally((()=>{r.textContent="Сохранить"})),_()})),y(w),P.addEventListener("submit",(function(t){const r=t.target.querySelector(".button");r.textContent="Сохранение...",t.preventDefault();(t=>fetch(`${e.baseUrl}/users/me`,{method:"PATCH",headers:e.headers,body:JSON.stringify(t)}).then(n))({name:D.value,about:N.value}).then((e=>{B.textContent=e.name,J.textContent=e.about})).catch(a).finally((()=>{r.textContent="Сохранить"})),_()})),y(E),A.addEventListener("submit",(function(t){const r=t.target.querySelector(".button");r.textContent="Сохранение...",t.preventDefault();const o={name:$.value,link:T.value};A.reset(),(t=>fetch(`${e.baseUrl}/cards`,{method:"POST",headers:e.headers,body:JSON.stringify(t)}).then(n))(o).then((e=>{l(b,I,u,i,e,H)})).catch(a).finally((()=>{r.textContent="Сохранить"})),_()})),y(O),C.addEventListener("click",(function(){p(L),S(L,M)})),x.addEventListener("click",(function(){p(E),S(E,M)})),U.addEventListener("click",(function(e){p(w),S(w,M),P.name.value=B.textContent,P.description.value=J.textContent})),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((n=>{n.addEventListener("input",(()=>{((e,t,r)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?f(e,t,r):((e,t,r,o)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.add(o.errorClass),n.textContent=r,n.classList.add(o.errorClassTextActive)})(e,t,t.validationMessage,r)})(e,n,t),v(r,o,t)}))}))})(t,e)}))})(M)})();